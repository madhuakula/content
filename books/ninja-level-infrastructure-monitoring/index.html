
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Introduction Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="setup.html" />
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter active" data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="setup.html">
            
                <a href="setup.html">
            
                    
                    Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="backup-elasticsearch.html">
            
                <a href="backup-elasticsearch.html">
            
                    
                    Backup Elasticsearch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="alerting-and-dashboards.html">
            
                <a href="alerting-and-dashboards.html">
            
                    
                    Alerting & Dashboards
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="ansible-playbook.html">
            
                <a href="ansible-playbook.html">
            
                    
                    Ansible Playbook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="security-testing.html">
            
                <a href="security-testing.html">
            
                    
                    Security Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="general-best-practices-checklist.html">
            
                <a href="general-best-practices-checklist.html">
            
                    
                    General Best Practices Checklist
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="exercise.html">
            
                <a href="exercise.html">
            
                    
                    Exercise
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="alternative-options.html">
            
                <a href="alternative-options.html">
            
                    
                    EXTRA: Alternatives
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="elasticsearch-config-checklist.html">
            
                <a href="elasticsearch-config-checklist.html">
            
                    
                    EXTRA: Elasticsearch Configuration Checklist
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="references.html">
            
                <a href="references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="license.html">
            
                <a href="license.html">
            
                    
                    License
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="q-and-a.html">
            
                <a href="q-and-a.html">
            
                    
                    Q&A
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Introduction</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="ninja-level-infrastructure-monitoring">Ninja level Infrastructure Monitoring</h1>
<h4 id="defensive-approach-to-security-monitoring--automation">Defensive approach to Security Monitoring &amp; Automation</h4>
<h3 id="defcon24---las-vegas">Defcon24 - Las Vegas</h3>
<p>Hello everyone :)
Welcome to our awesome workshop!</p>
<p>Refer to <a href="https://github.com/madhuakula/defcon24-infra-monitoring-workshop" target="_blank">https://github.com/madhuakula/defcon24-infra-monitoring-workshop</a> for scripts, playbooks, configs, etc.</p>
<h2 id="schedule">SCHEDULE</h2>
<ul>
<li>Saturday, 6th August 2016</li>
<li>10:00 - 14:00</li>
<li>There will be a 15 minute break at 11:45 AM</li>
</ul>
<h2 id="overview">Overview</h2>
<ul>
<li>Basic overview: 30 min</li>
<li>Setting up the ELK stack (hands on): 75 min</li>
<li>Backing up elasticsearch using curator (hands on): 15 min</li>
<li>Alerting &amp; Advanced dashboards (hands on): 30 min</li>
<li>A note on best practices: 10 min</li>
<li>Penetration testing findings: 10 min</li>
<li>Ansible Playbook for the entire setup: 10 min</li>
<li>Exercise (hands on): 30 min</li>
<li>Q &amp; A</li>
</ul>
<h3 id="pre-requisites">Pre-requisites</h3>
<ul>
<li>This workshop is intended for beginner to mid-level, we are expecting that participants are comfortable with basic Linux CLI usage</li>
<li>Laptop with administrative privileges (to install VirtualBox)</li>
<li>VirtualBox</li>
<li>20GB hard disk space for virtual machines</li>
<li>Minimum 4 GB RAM</li>
<li>Enthusiasm to learn cool stuff :)</li>
</ul>
<h2 id="instructions">Instructions</h2>
<ol>
<li>Please follow the commands and the overall flow as given in the slides</li>
<li>Please direct all questions/queries to me and Madhu</li>
</ol>
<h2 id="what-will-you-learn-today">What will you learn today?</h2>
<ul>
<li>Infrastructure monitoring by aggregating and analysing logs</li>
<li>Centralised logging using the ELK stack</li>
<li>Creating attack pattern dashboards for monitoring</li>
<li>Exporting and Importing dashboards for reporting and reuse</li>
<li>Advanced configurations of the ELK stack</li>
</ul>
<h2 id="bonus">(Bonus)</h2>
<p>Best practices and Security Tips</p>
<h2 id="what-we-are-not-covering">What we are not covering</h2>
<ul>
<li>Performance tuning and optimisation for clusters</li>
<li>Multi cluster configurations</li>
<li>Custom plugins and scripts for Logstash</li>
</ul>
<blockquote>
<p>Note: Time constraint + Internet access + Resource constraints</p>
</blockquote>
<h2 id="so-what-is-ninja-level-infrastructure-monitoring">So what is Ninja Level Infrastructure Monitoring?</h2>
<h3 id="what-is-monitoring">What is monitoring?</h3>
<p><img src="images/monitor.png" alt=""></p>
<p>Note: observe an event and check the progress over a period of time.</p>
<h3 id="what-is-this-infrastructure-we-keep-talking-about">What is this &apos;infrastructure&apos; we keep talking about?</h3>
<blockquote>
<p><img src="images/itinfra.png" alt=""></p>
</blockquote>
<p>Note: All your assets in an enterprisey environment. The routers, firewalls, web app servers, linux boxes, ldap servers, database servers etc.</p>
<h3 id="what-is-ninja-level">What is &apos;Ninja level&apos;?</h3>
<blockquote>
<p>Errrrr.. This was simply added to make this workshop title cooler :)</p>
</blockquote>
<p><img src="images/ninja.png" alt=""></p>
<h2 id="about-us">About us</h2>
<h3 id="madhu-akula">Madhu Akula</h3>
<ul>
<li>Automation Ninja @Appsecco</li>
<li>Security &amp; DevOps lover</li>
<li>Trainer &amp; Speaker</li>
<li>Acknowledged by more than 200 giant companies like Google, Microsoft, Yahoo, Adobe, etc for finding security vulnerabilities</li>
<li>Open source contributor</li>
<li>Never ending learner!</li>
<li>Twitter: @madhuakula</li>
</ul>
<h3 id="riyaz-walikar">Riyaz Walikar</h3>
<ul>
<li>Chief Offensive Security Officer @Appsecco</li>
<li>Over 9 years of industry experience in breaking infrastructure security and web applications</li>
<li>Security evangelist, leader for null Bangalore and OWASP chapters</li>
<li>Trainer/Speaker : BlackHat Asia, BlackHat USA, nullcon Goa, nullcon Delhi, c0c0n, OWASP AppSec USA</li>
<li>Twitter : @riyazwalikar and @wincmdfu</li>
</ul>
<h3 id="quick-look-at-the-basics-of-centralised-logging">Quick look at the basics of &quot;centralised&quot; logging</h3>
<h2 id="what-are-logs">What are logs?</h2>
<ul>
<li>A log (file) is a collection of records or events</li>
<li>Logs used to be a (often indecipherable) line of text intended for offline human analysis of what went wrong</li>
<li>Logs are a critical part of any system giving you an insight into the working of a system</li>
</ul>
<h2 id="why-is-it-boring-to-work-with-logs">Why is it boring to work with logs?</h2>
<ul>
<li>Can be pretty large</li>
<li>Correlation can be painful</li>
<li>Others?</li>
</ul>
<h2 id="what-is-centralised-logging">What is centralised logging?</h2>
<ul>
<li>Managing logs and accessing them can get complicated with multiple hosts</li>
<li>Searching for a particular error across hundreds of log files on hundreds of servers is difficult without good tools</li>
<li>A common approach to this problem is to setup a centralised logging solution so that multiple logs can be aggregated in a central location</li>
</ul>
<h3 id="how-is-it-different-from-traditional-logging">How is it different from traditional logging?</h3>
<ul>
<li>Logs are collected at a central server</li>
<li>Parsing becomes simpler since data is accessible at a single location</li>
<li>A common issue across multiple hosts/services can be identified by correlating specific time frames</li>
</ul>
<h3 id="what-are-the-problems-of-traditional-logging">What are the problems of traditional logging?</h3>
<h4 id="no-consistency">No Consistency</h4>
<p>(it&#x2019;s difficult to be jack-of-all trades)</p>
<ul>
<li>Difficulty in logging for each application, system, device</li>
<li>Interpreting various type of logs</li>
<li>Variation in format makes it challenging to search</li>
<li>Many types of time formats</li>
</ul>
<h4 id="no-centralisation">No Centralisation</h4>
<p>(simply put, log data is everywhere)</p>
<ul>
<li>Logs in many locations on various servers</li>
<li>SSH + GREP don&#x2019;t scale</li>
</ul>
<h4 id="accessibility-of-log-data">Accessibility of Log Data</h4>
<p>(much of the data is difficult to locate and manage)</p>
<ul>
<li>Access is often difficult</li>
<li>High expertise to mine data</li>
<li>Logs can be difficult to find</li>
<li>Immense size of Log Data</li>
</ul>
<h2 id="the-elk-stack">The ELK stack</h2>
<h3 id="elasticsearch-logstash-and-kibana">Elasticsearch, Logstash and Kibana</h3>
<p>Different open source modules working together</p>
<ul>
<li>Helps users/admins to collect, analyse and visualise data in (near) real-time</li>
<li>Each module fits based on your use case and environment</li>
</ul>
<h3 id="components-of-the-stack">Components of the stack</h3>
<ul>
<li>Elasticsearch</li>
<li>Logstash</li>
<li>Kibana</li>
<li>(Beats)</li>
</ul>
<h2 id=""><img src="images/elasticsearch_def.png" alt=""></h2>
<p>Ref: <a href="https://www.elastic.co/products" target="_blank">https://www.elastic.co/products</a></p>
<h2 id="elasticsearch">Elasticsearch</h2>
<ul>
<li>Distributed and Highly available search engine, written in Java and uses Groovy</li>
<li>Built on top of Lucene</li>
<li>Multi Tenant with Multi types and a set of APIs</li>
<li>Document Oriented providing (near) real time search</li>
</ul>
<h2 id=""><img src="images/logstash_def.png" alt=""></h2>
<p>Ref: <a href="https://www.elastic.co/products" target="_blank">https://www.elastic.co/products</a></p>
<h2 id="logstash">Logstash</h2>
<ul>
<li>Tool for managing events and logs written in Ruby</li>
<li>Centralised data processing of all types of logs</li>
<li>Consists of 3 main components<ul>
<li>Input : Passing logs to process them into machine understandable format</li>
<li>Filter : Set of conditions to perform specific action on a event</li>
<li>Output : Decision maker for processed events/logs</li>
</ul>
</li>
</ul>
<h2 id=""><img src="images/kibana_def.png" alt=""></h2>
<p>Ref: <a href="https://www.elastic.co/products" target="_blank">https://www.elastic.co/products</a></p>
<h3 id="kibana">Kibana</h3>
<ul>
<li>Powerful front-end dashboard written in JavaScript</li>
<li>Browser based analytics and search dashboard for Elasticsearch</li>
<li>Flexible analytics &amp; visualisation platform</li>
<li>Provides data in the form of charts, graphs, counts, maps, etc. in real-time</li>
</ul>
<h2 id=""><img src="images/beats_def.png" alt=""></h2>
<p>Ref: <a href="https://www.elastic.co/products" target="_blank">https://www.elastic.co/products</a></p>
<h3 id="beats">Beats</h3>
<ul>
<li>Lightweight shippers for Elasticsearch &amp; Logstash</li>
<li>Capture all sorts of operational data like logs or network packet data</li>
<li>It can send logs to either elasticsearch, logstash</li>
<li>Different kind of beats<ul>
<li>Libbeat : The Go framework for creating new Beats</li>
<li>Packetbeat : Tap into your wire data</li>
<li>Filebeat : Lightweight log forwarder to Logstash &amp; Elasticsearch</li>
<li>Winlogbeat : Sends windows event logs</li>
</ul>
</li>
</ul>
<h4 id="filebeat">Filebeat</h4>
<ul>
<li>Lightweight Shipper for Log Data</li>
<li>Filebeat is an opensource file harvester</li>
<li>Used to fetch logs files and feed them into logstash</li>
<li>It has replaced logstash-forwarder</li>
</ul>
<h2 id="elk-overview">ELK overview</h2>
<blockquote>
<p><img src="images/elk_overall.png" alt=""></p>
</blockquote>
<p>Ref: <a href="https://www.elastic.co/products" target="_blank">https://www.elastic.co/products</a></p>
<h2 id="a-quick-history-lesson">A quick history lesson</h2>
<h3 id="about-elastic">About Elastic</h3>
<ul>
<li><code>Shay Banon</code> created Compass in 2004, third version of Compass is the first version of Elasticsearch, released in Feb 2010</li>
<li>Elasticsearch was founded in 2012, Rashid (Kibana) joined Jan 2013 and Jordan (Logstash) joined in Aug 2013. (elastic.co)</li>
<li>Combined stack is now called <code>Elastic Stack</code> and <code>X-Pack</code></li>
</ul>
<h2 id="terms-we-should-be-aware-of-in-context-to-elk">Terms we should be aware of in context to ELK</h2>
<h3 id="node">Node</h3>
<blockquote>
<p>A node is a running instance of elasticsearch which belongs to a cluster.</p>
</blockquote>
<h3 id="cluster">Cluster</h3>
<blockquote>
<p>Cluster is a collection of one or more nodes that together holds your entire data and provides indexing and search capabilities across all nodes. </p>
<p>Nodes must have the same cluster.name to belong to the same cluster.</p>
</blockquote>
<h3 id="document">Document</h3>
<blockquote>
<p>A document is a basic unit of information that can be stored and searched. </p>
<p>It refers to the top-level, or root object that is serialised into JSON and stored in Elasticsearch under a unique ID.</p>
</blockquote>
<h3 id="index">Index</h3>
<blockquote>
<p>An index is a collection of documents that have somewhat similar characteristics. It has mappings which define multiple types.</p>
</blockquote>
<h3 id="type">Type</h3>
<blockquote>
<p>Within an index, you can define one or more types. A type is a logical category/partition of your index whose semantics are completely up to you.</p>
</blockquote>
<h3 id="shard">Shard</h3>
<blockquote>
<p>Elasticsearch provides the ability to subdivide an index into multiple pieces called shards since an index can store a large amount of data that can exceed the hardware limits of a single node. </p>
<p>Each shard is in itself a fully-functional and independent &quot;index&quot; that can be hosted on any node in the cluster.</p>
<p>For eg, a single index of a billion docs taking up 1TB of disk space may not fit on the disk of a single node or may be too slow to serve search requests from a single node alone. When you create an index, you can simply define the number of shards that you want.</p>
</blockquote>
<h3 id="replica">Replica</h3>
<blockquote>
<p>Elasticsearch allows you to make one or more copies of your index&#x2019;s shards into what are called replica shards, or replicas for short.</p>
<p>For this reason, it is important to note that a replica shard is never allocated on the same node as the original/primary shard that it was copied from. It provides high availability in case a shard/node fails. Also to scale out your search volume/throughput since searches can be executed on all replicas in parallel</p>
</blockquote>
<h3 id="snapshot-and-restore">Snapshot and Restore</h3>
<blockquote>
<p>A copy of the current state and data in a cluster that is saved to a shared repository.</p>
<p>Elasticsearch provides a snapshot API to achieve this.</p>
</blockquote>
<h3 id="routing">Routing</h3>
<blockquote>
<p>A mechanism in Elasticsearch that identifies which shard a particular document resides in.</p>
</blockquote>
<h3 id="near-real-time">Near real time</h3>
<blockquote>
<p>Elasticsearch is a near real time search platform. </p>
<p>What this means is there is a slight latency (normally one second) from the time you index a document until the time it becomes searchable.</p>
</blockquote>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="setup.html" class="navigation navigation-next navigation-unique" aria-label="Next page: Setup">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Introduction","level":"1.1","depth":1,"next":{"title":"Setup","level":"1.2","depth":1,"path":"setup.md","ref":"setup.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["ga"],"pluginsConfig":{"ga":{"configuration":"auto","token":"UA-15752161-2"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"README.md","mtime":"2020-06-01T10:14:35.047Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-06-01T11:38:35.474Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

